<h2 mat-dialog-title>{{ 'USER_DIALOG.ADD_USER_TITLE' | translate }}</h2>

<mat-dialog-content style="max-width: 600px">
  <form #userForm="ngForm">
    <!-- Name Field -->
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>{{ 'USER_DIALOG.NAME_LABEL' | translate }}</mat-label>
      <input matInput name="nom" [(ngModel)]="local_data.nom" required #nomCtrl="ngModel" />
      <mat-error *ngIf="nomCtrl.invalid && (nomCtrl.touched || nomCtrl.dirty)">
        {{ 'USER_DIALOG.NAME_LABEL' | translate }} est requis.
      </mat-error>
    </mat-form-field>

    <!-- Email Field -->
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>{{ 'USER_DIALOG.EMAIL_LABEL' | translate }}</mat-label>
      <input
        matInput
        name="email"
        [(ngModel)]="local_data.email"
        type="email"
        required
        [pattern]="emailPattern"
        #emailCtrl="ngModel"
        (blur)="emailCtrl.control?.markAsTouched()"
      />
      <mat-error *ngIf="emailCtrl.invalid && (emailCtrl.touched || emailCtrl.dirty)">
        <ng-container *ngIf="emailCtrl.errors?.['required']">Email requis.</ng-container>
        <ng-container *ngIf="!emailCtrl.errors?.['required']">Format d’email invalide.</ng-container>
      </mat-error>
    </mat-form-field>

    <!-- Password Field -->
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>{{ 'USER_DIALOG.PASSWORD_LABEL' | translate }}</mat-label>
      <input
        matInput
        name="mot_de_passe"
        [(ngModel)]="local_data.mot_de_passe"
        type="password"
        required
        #pwdCtrl="ngModel"
      />
      <mat-error *ngIf="pwdCtrl.invalid && (pwdCtrl.touched || pwdCtrl.dirty)">
        Mot de passe requis.
      </mat-error>
    </mat-form-field>

    <!-- Role Field -->
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Rôle</mat-label>
      <mat-select [(ngModel)]="local_data.type" name="type" required [disabled]="isResponsable">
        <mat-option value="employe">Employé</mat-option>
        <mat-option value="responsable">Responsable</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Photo upload -->
    <div class="m-t-12">
      <div class="text-center">
        <img *ngIf="preview" [src]="preview" width="120" height="120" class="rounded-circle" style="object-fit: cover" />
      </div>

      <div class="d-flex gap-8 m-t-12">
        <input #fileInput type="file" accept="image/*" hidden (change)="onFileChange($event)" />
        <button mat-stroked-button type="button" (click)="fileInput.click()">
          Choisir une image
        </button>
        <span class="mat-body-2">JPG/PNG/GIF — max 800KB</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-end m-t-16">
      <button mat-flat-button color="primary" [disabled]="!userForm.valid" (click)="createUser()">
        {{ 'USER_DIALOG.ADD_BUTTON' | translate }}
      </button>
      <button mat-stroked-button color="warn" class="m-l-8" (click)="closeDialog()">
        {{ 'USER_DIALOG.CANCEL_BUTTON' | translate }}
      </button>
    </div>
  </form>
</mat-dialog-content>
