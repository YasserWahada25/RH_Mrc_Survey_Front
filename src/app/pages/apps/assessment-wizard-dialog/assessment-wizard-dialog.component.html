<!-- src/app/pages/apps/assessment-wizard-dialog/assessment-wizard-dialog.component.html -->

<h2 mat-dialog-title>Cr√©er un assessment</h2>

<mat-dialog-content class="wizard-content">
  <!-- Nom de l‚Äôassessment -->
  <mat-form-field appearance="outline" class="w-100 mb-4">
    <mat-label>Nom de l‚Äôassessment</mat-label>
    <input matInput [(ngModel)]="local.name" name="name" required />
  </mat-form-field>

  <!-- üëáüëáüëá  AJOUT : Entreprise -->
<mat-form-field appearance="outline" class="w-100 mb-4">
  <mat-label>Entreprise</mat-label>
  <input matInput [(ngModel)]="local.company" name="company" required  />
</mat-form-field>

<!-- üëáüëáüëá  AJOUT : Nom du formateur -->
<mat-form-field appearance="outline" class="w-100 mb-4">
  <mat-label>Nom du formateur</mat-label>
  <input matInput [(ngModel)]="local.trainerName" name="trainerName" required  />
</mat-form-field>

  <!-- Type d‚Äôassessment -->
  <mat-form-field appearance="outline" class="w-100 mb-4">
    <mat-label>Type d‚Äôassessment</mat-label>
    <mat-select [(ngModel)]="local.type" name="type" required>
      <mat-option [value]="'normal'">Normal</mat-option>
      <mat-option [value]="'avant_apres'">Avant / Apr√®s</mat-option>
    </mat-select>
  </mat-form-field>

  <!-- Dates de formation -->
  <div *ngIf="local.type === 'avant_apres'" class="mb-4">
    <mat-form-field appearance="outline" class="w-100 mb-2">
      <mat-label>Date d√©but de formation</mat-label>
      <input matInput [(ngModel)]="local.startDate" name="startDate" type="date" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Date fin de formation</mat-label>
      <input matInput [(ngModel)]="local.endDate" name="endDate" type="date" required />
    </mat-form-field>
  </div>

  <!-- Questions -->
  <button mat-button color="primary" (click)="addTask()">
    <mat-icon>add</mat-icon> Nouvelle Question
  </button>

  <div *ngFor="let t of local.tasks; let ti = index" class="task-block">
    <div class="d-flex align-items-center mb-2">
      <h4>Question {{ ti + 1 }}</h4>
      <button mat-icon-button color="warn" (click)="removeTask(ti)">
        <mat-icon>delete</mat-icon>
      </button>
    </div>

    <!-- Description -->
    <mat-form-field appearance="outline" class="w-100 mb-2">
      <mat-label>Description</mat-label>
      <input matInput [(ngModel)]="t.description" name="desc{{ti}}" required />
    </mat-form-field>

    <!-- Options -->
    <div class="d-flex align-items-center mb-1">
      <div class="flex-grow-1 font-weight-semibold">Option</div>
      <div class="font-weight-semibold">Correcte ?</div>
    </div>
    <mat-divider class="mb-2"></mat-divider>

    <div *ngFor="let o of t.options; let oi = index" class="row-cell mb-2 d-flex align-items-center">
      <mat-form-field appearance="outline" class="flex-grow-1 me-2">
        <input
          matInput
          placeholder="Texte"
          [(ngModel)]="o.text"
          name="optText{{ti}}_{{oi}}"
        />
      </mat-form-field>

      <mat-checkbox
        [(ngModel)]="o.isCorrect"
        name="optCorrect{{ti}}_{{oi}}"
        style="margin-right: 12px;"
      >
      </mat-checkbox>

      <button mat-icon-button color="warn" (click)="removeOption(ti, oi)">
        <mat-icon>delete</mat-icon>
      </button>
    </div>

    <div class="text-end mb-4">
      <button mat-mini-fab color="primary" (click)="addOption(ti)">
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button
    mat-flat-button
    color="primary"
    (click)="finish()"
    [disabled]="!local.name.trim() || !local.type || !local.company.trim() || !local.trainerName.trim()"
  >
    Enregistrer
  </button>
  <button mat-stroked-button color="warn" (click)="cancel()">
    Annuler
  </button>
</mat-dialog-actions>
