<mat-card class="assessment-card" *ngIf="assessment">
  <mat-card-content>
    <!-- 🧠 EN-TÊTE -->
    <div class="assessment-header">
      <h1 class="assessment-title">{{ assessment.name }}</h1>
      <p class="assessment-type">
        Type : {{ assessment.type === 'normal' ? 'Normal' : 'Avant / Après' }}
      </p>

      <ng-container *ngIf="assessment.type === 'avant_apres' && assessment.startDate && assessment.endDate">
        <p class="assessment-dates">
          📅 Formation : du {{ assessment.startDate | date:'dd/MM/yyyy' }} au {{ assessment.endDate | date:'dd/MM/yyyy' }}
        </p>
      </ng-container>

      <ng-container *ngIf="!adminMode && phase === 'avant' || phase === 'apres'">
        <p class="assessment-phase">Phase : «{{ phase | titlecase }}»</p>
      </ng-container>
    </div>

    <!-- 👨‍💼 MODE ADMIN -->
    <ng-container *ngIf="adminMode; else userForm">
      <div class="questions-list">
        <ng-container *ngFor="let t of assessment.tasks; let i = index">
          <mat-card class="question-card">
            <mat-card-header>
              <mat-card-title>Q{{ i + 1 }}. {{ t.description }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-radio-group [disabled]="true" class="options-group">
                <mat-radio-button
                  *ngFor="let o of t.options"
                  [value]="o.score"
                >
                  {{ o.text }}
                </mat-radio-button>
              </mat-radio-group>
            </mat-card-content>
          </mat-card>
        </ng-container>
      </div>
      <div class="submit-container">
        <button mat-raised-button color="accent" (click)="sendByEmail()">
          Envoyer par email
        </button>
      </div>
    </ng-container>

    <!-- 👤 MODE UTILISATEUR -->
    <ng-template #userForm>
      <form (ngSubmit)="onSubmit()">
        <div class="questions-list">
          <ng-container *ngFor="let t of assessment.tasks; let i = index">
            <mat-card class="question-card">
              <mat-card-header>
                <mat-card-title>Q{{ i + 1 }}. {{ t.description }}</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <mat-radio-group
                  [(ngModel)]="answers[t._id]"
                  name="ans{{i}}"
                  class="options-group"
                  [disabled]="disabledForm"
                >
                  <mat-radio-button
                    *ngFor="let o of t.options"
                    [value]="o.score"
                  >
                    {{ o.text }}
                  </mat-radio-button>
                </mat-radio-group>
              </mat-card-content>
            </mat-card>
          </ng-container>
        </div>
        <div class="submit-container">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="disabledForm"
          >
            Soumettre
          </button>
        </div>
      </form>
    </ng-template>
  </mat-card-content>
</mat-card>
