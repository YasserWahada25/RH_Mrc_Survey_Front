<mat-card class="assessment-card" *ngIf="assessment">
  <mat-card-content>
    <!-- EN-TÊTE -->
    <div class="assessment-header">
      <div class="title-block">
        <h1 class="assessment-title">{{ assessment.name }}</h1>
        <p class="assessment-type">
          Type :
          {{ assessment.type === "normal" ? "Réponse unique" : "Avant / Après" }}
        </p>
        <ng-container *ngIf="assessment.type === 'avant_apres' && assessment.startDate && assessment.endDate">
          <p class="assessment-dates">
            📅 Formation : du {{ assessment.startDate | date : "dd/MM/yyyy" }} au
            {{ assessment.endDate | date : "dd/MM/yyyy" }}
          </p>
        </ng-container>
        <ng-container *ngIf="phase === 'avant' || phase === 'apres'">
          <p class="assessment-phase">Phase : «{{ phase | titlecase }}»</p>
        </ng-container>
      </div>
    </div>

    <!-- FORMULAIRE -->
    <form (ngSubmit)="onSubmit()">
      <!-- ✅ Message préremplissage -->
      <div *ngIf="readOnlyUser" class="info-message">
        📝 Vos informations ont été préremplies automatiquement.
      </div>

      <!-- INFOS UTILISATEUR -->
      <div class="user-info-form">
        <mat-form-field appearance="outline" class="info-field">
          <mat-label>Prénom</mat-label>
          <input matInput [(ngModel)]="firstName" name="firstName" required [readonly]="readOnlyUser" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="info-field">
          <mat-label>Nom</mat-label>
          <input matInput [(ngModel)]="lastName" name="lastName" required [readonly]="readOnlyUser" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="info-field">
          <mat-label>Email</mat-label>
          <input matInput [(ngModel)]="email" name="email" type="email" required [readonly]="readOnlyUser" />
        </mat-form-field>
      </div>

      <!-- QUESTIONS -->
      <div class="questions-list">
        <ng-container *ngFor="let t of assessment.tasks; let i = index">
          <mat-card class="question-card">
            <mat-card-header>
              <mat-card-title>Q{{ i + 1 }}. {{ t.description }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-radio-group
                [(ngModel)]="answers[t._id]"
                name="ans{{ i }}"
                class="options-group"
                [disabled]="disabledForm"
              >
                <mat-radio-button *ngFor="let o of t.options" [value]="o._id">
                  {{ o.text }}
                </mat-radio-button>
              </mat-radio-group>
            </mat-card-content>
          </mat-card>
        </ng-container>
      </div>

      <!-- BOUTON -->
      <div class="submit-container">
        <button mat-raised-button color="primary" type="submit" [disabled]="disabledForm">
          Soumettre
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
